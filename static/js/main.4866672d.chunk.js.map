{"version":3,"sources":["components/XOElement/XOElement.module.css","components/XOGame/XOGame.module.css","components/App.module.css","components/XOField/XOField.module.css","helpers/gameWebsocket.ts","components/XOField/XOField.tsx","helpers/classnames.ts","components/XOElement/XOElement.tsx","hooks/useGame.ts","components/XOGame/XOGame.tsx","components/App.tsx","index.tsx"],"names":["module","exports","GameStatus","BoardElements","ActionType","XOField","width","height","renderElement","cssVars","elements","Array","fill","map","_","index","x","y","Math","floor","className","styles","container","style","mix","args","filter","Boolean","join","wsGameMap","Map","removeGameWebsocket","gameId","has","get","close","delete","classes","appear","appearActive","appearDone","exit","exitActive","exitDone","XOElement","type","CSSTransition","in","mountOnEnter","timeout","classNames","element","O","useGame","useState","game","setGame","useEffect","gameWS","set","WebSocket","uuid","createGameWebsocket","onmessage","event","data","JSON","parse","payload","UpdateState","error","console","onclose","info","onerror","generateElementKey","isGameFinished","status","Lose","Won","includes","Element","props","onClick","useCallback","key","XOGame","id","onGameCreate","onElementClick","board","N","move","Error","send","stringify","sendGameMove","onRestartGame","winner","restart","App","window","location","reload","app","header","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.4866672d.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"element\":\"XOElement_element__1KEMr\",\"element-appear\":\"XOElement_element-appear__1ES5B\",\"element-appear-done\":\"XOElement_element-appear-done__WJCRD\",\"element-appear-active\":\"XOElement_element-appear-active__136G1\",\"element-exit\":\"XOElement_element-exit__1_0jh\",\"element-exit-done\":\"XOElement_element-exit-done__6EZ22\",\"element-exit-active\":\"XOElement_element-exit-active__2EGW7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"game\":\"XOGame_game__15uXp\",\"container\":\"XOGame_container__1yCti\",\"element\":\"XOGame_element__1MduJ\",\"winner-element\":\"XOGame_winner-element__3AreA\",\"game-info\":\"XOGame_game-info__2wluV\",\"winner\":\"XOGame_winner__X4RP5\",\"restart\":\"XOGame_restart__27bp6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"App_app__1tA9O\",\"header\":\"App_header__14Wxn\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"XOField_container__3ahhw\"};","import { v4 as uuid } from 'uuid';\n\nconst SERVER_URL = 'ws://37.140.186.91:8000/game';\n\nconst wsGameMap: Map<string, WebSocket> = new Map();\n\nexport enum GameStatus {\n    Move = 'MOVE',\n    Waiting = 'WAITING',\n    Won = 'WON',\n    Lose = 'LOSE',\n}\nexport enum BoardElements {\n    X = 'x',\n    O = 'o',\n    N = 'n',\n}\nexport type BoardRow = [BoardElements, BoardElements, BoardElements];\nexport type Board = [BoardRow, BoardRow, BoardRow];\nexport type GamePayload = {\n    board: Board;\n    status: GameStatus;\n}\nexport enum ActionType {\n    UpdateState = 'UPDATE_STATE'\n}\n\nexport const createGameWebsocket = (gameId: string) => {\n    if (wsGameMap.has(gameId)) {\n        return wsGameMap.get(gameId)!;\n    }\n\n    wsGameMap.set(gameId, new WebSocket(`${SERVER_URL}/${gameId}/${uuid()}`));\n\n    return wsGameMap.get(gameId)!;\n};\n\nexport const removeGameWebsocket = (gameId: string) => {\n    if (wsGameMap.has(gameId)) {\n        wsGameMap.get(gameId)!.close(1000, 'Игра завершена');\n    }\n\n    return wsGameMap.delete(gameId);\n};\n\nexport const parseGameWebsocketMessage = (data: string) => {\n    return JSON.parse(data) as { type: ActionType, payload: GamePayload };\n};\n\nexport const sendGameMove = (gameId: string, move: [number, number]) => {\n    if (!wsGameMap.get(gameId)) {\n        throw new Error(`игры с id=${gameId} не существует`);\n    }\n\n    wsGameMap.get(gameId)!.send(JSON.stringify(move));\n};\n\n\n","import React from 'react';\n\nimport styles from './XOField.module.css';\n\ntype Props = {\n    width: number;\n    height: number;\n    renderElement: (x: number, y: number) => React.ReactNode\n};\nconst XOField: React.FC<Props> = ({ width, height, renderElement }) => {\n    const cssVars = {\n        '--xo-game-width': width,\n        '--xo-game-height': height,\n    };\n\n    const elements = Array(width * height)\n        .fill(null)\n        .map((_, index) => {\n            const x = index % height;\n            const y = Math.floor(index / width);\n\n            return renderElement(x, y);\n        });\n\n    return (\n        <div className={styles.container} style={cssVars as React.CSSProperties}>\n            {elements}\n        </div>\n    );\n};\n\nexport default XOField;\n","export const mix = (...args: Array<string|undefined|null|false>) => {\n    return args.filter(Boolean).join(' ');\n};\n","import React from 'react';\nimport { CSSTransition } from 'react-transition-group';\n\nimport { mix } from '../../helpers/classnames';\nimport { BoardElements } from '../../helpers/gameWebsocket';\n\nimport styles from './XOElement.module.css';\n\nconst classes = {\n    appear: styles['element-appear'],\n    appearActive: styles['element-appear-active'],\n    appearDone: styles['element-appear-done'],\n    exit: styles['element-exit'],\n    exitActive: styles['element-exit-active'],\n    exitDone: styles['element-exit-done'],\n};\n\nexport type Props = {\n    type?: BoardElements\n};\nconst XOElement: React.FC<Props> = ({ type }) => {\n    return (\n        <CSSTransition\n            in={Boolean(type)}\n            appear\n            mountOnEnter\n            timeout={1000}\n            classNames={classes}\n        >\n            <div className={mix(styles.element, type && styles[type])}>\n                {type ? type === BoardElements.O ? 'O' : 'X' : '' }\n            </div>\n        </CSSTransition>\n    );\n};\n\nexport default XOElement;\n","import { useEffect, useState } from 'react';\n\nimport {\n    ActionType,\n    GamePayload,\n    createGameWebsocket,\n    parseGameWebsocketMessage,\n    removeGameWebsocket\n} from '../helpers/gameWebsocket';\n\nexport function useGame(gameId: string) {\n    const [game, setGame] = useState<GamePayload>();\n\n    useEffect(() => {\n        const gameWS = createGameWebsocket(gameId);\n\n        gameWS.onmessage = (event) => {\n            try {\n                const { type, payload } = parseGameWebsocketMessage(event.data);\n\n                if (type === ActionType.UpdateState ) {\n                    setGame(payload);\n                }\n            } catch (error) {\n                console.error(`Не удалось распарсить сообщение`, error);\n            }\n        };\n        gameWS.onclose = (event) => {\n            removeGameWebsocket(gameId);\n            console.info('Соединение закрыто:', event);\n        };\n        gameWS.onerror = (error) => {\n            console.error(`Ошибка соединения`, error);\n        };\n\n        return () => {\n            gameWS.close(1000, 'Изменился идентификатор игры');\n        };\n    }, [gameId]);\n\n    return game;\n}\n","import React, { useCallback } from 'react';\n\nimport XOField from '../XOField/XOField';\nimport XOElement from '../XOElement/XOElement';\n\nimport { mix } from '../../helpers/classnames';\nimport { BoardElements, GameStatus, removeGameWebsocket, sendGameMove } from '../../helpers/gameWebsocket';\nimport { useGame } from '../../hooks/useGame';\n\nimport styles from './XOGame.module.css';\n\nconst generateElementKey = (x: number, y: number, type: BoardElements) => `${x}-${y}-${type}`;\n\nconst isGameFinished = (status: GameStatus) => [GameStatus.Lose, GameStatus.Won].includes(status);\n\ntype ElementProps = {\n    x: number;\n    y: number;\n    type: BoardElements;\n    onClick: (x: number, y: number) => void;\n    className?: string;\n};\nconst Element: React.FC<ElementProps> = props => {\n    const { x, y, type, className } = props;\n    const onClick = useCallback(() => {\n        props.onClick(props.x, props.y);\n    }, [props]);\n\n    return (\n        <div\n            key={generateElementKey(x, y, type)}\n            className={styles.container}\n            onClick={onClick}\n        >\n            <div className={mix(styles.element, className)} >\n                <XOElement type={type} />\n            </div>\n        </div>\n    );\n};\ntype Props = {\n    id: string;\n    onGameCreate: () => void;\n}\nconst XOGame: React.FC<Props> = ({ id, onGameCreate }) => {\n    const game = useGame(id);\n\n    const onElementClick = useCallback((x: number, y: number) => {\n        if (!game) {\n            return;\n        }\n\n        const { board } = game;\n        const element = board[y][x];\n\n        if (element !== BoardElements.N || isGameFinished(game.status)) {\n            return;\n        }\n\n        sendGameMove(id, [x, y]);\n    }, [game, id]);\n\n    const renderElement = useCallback((x: number, y: number) => {\n        if (!game) {\n            return null;\n        }\n\n        return (\n            <Element\n                key={generateElementKey(x, y, game.board[y][x])}\n                x={x}\n                y={y}\n                type={game.board[y][x]}\n                onClick={onElementClick}\n                className={isGameFinished(game.status) ? styles['winner-element'] : ''}\n            />\n        );\n    }, [game, onElementClick]);\n\n    const onRestartGame = useCallback(() => {\n        removeGameWebsocket(id);\n\n        onGameCreate();\n    }, [id, onGameCreate]);\n\n    return (\n        <div className={styles.game}>\n            <XOField\n                width={3}\n                height={3}\n                renderElement={renderElement}\n            />\n            <div className={styles['game-info']}>\n                {game && isGameFinished(game.status) && (\n                    <div className={styles.winner}>\n                        {game.status === GameStatus.Won ?\n                            'Вы победили!' :\n                            'Вы проиграли'\n                        }\n                    </div>\n                )}\n                <button onClick={onRestartGame} className={styles.restart}>Играть заново</button>\n            </div>\n        </div>\n    );\n};\n\nexport default XOGame;\n","import React, { useCallback } from 'react';\n\nimport XOGame from './XOGame/XOGame';\n\nimport styles from './App.module.css';\n\nfunction App() {\n    const onGameCreate = useCallback(() => {\n        window.location.reload();\n    }, []);\n\n    return (\n        <div className={styles.app}>\n            <header className={styles.header}>\n                Величайшая победа – победа над самим собой!\n            </header>\n            <XOGame id='123' onGameCreate={onGameCreate} />\n        </div>\n    );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './components/App';\n\nimport './index.css';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}